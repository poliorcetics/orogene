<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Managing node_modules/ - Orogene</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="../guide/configuration.html"><strong aria-hidden="true">1.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../guide/node_modules.html" class="active"><strong aria-hidden="true">2.</strong> Managing node_modules/</a></li><li class="chapter-item expanded "><a href="../guide/telemetry.html"><strong aria-hidden="true">3.</strong> Telemetry</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Commands</li><li class="chapter-item expanded "><a href="../commands/add.html"><strong aria-hidden="true">4.</strong> add</a></li><li class="chapter-item expanded "><a href="../commands/apply.html"><strong aria-hidden="true">5.</strong> apply</a></li><li class="chapter-item expanded "><a href="../commands/ping.html"><strong aria-hidden="true">6.</strong> ping</a></li><li class="chapter-item expanded "><a href="../commands/reapply.html"><strong aria-hidden="true">7.</strong> reapply</a></li><li class="chapter-item expanded "><a href="../commands/remove.html"><strong aria-hidden="true">8.</strong> remove</a></li><li class="chapter-item expanded "><a href="../commands/view.html"><strong aria-hidden="true">9.</strong> view</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Development</li><li class="chapter-item expanded "><a href="../contributind.html"><strong aria-hidden="true">10.</strong> Contributing Guide</a></li><li class="chapter-item expanded "><a href="../code-of-conduct.html"><strong aria-hidden="true">11.</strong> Code of Conduct</a></li><li class="chapter-item expanded "><a href="../changelog.html"><strong aria-hidden="true">12.</strong> Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Orogene</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="managing-node_modules"><a class="header" href="#managing-node_modules">Managing <code>node_modules/</code></a></h1>
<p>The whole point of Orogene is to manage <code>node_modules/</code> directories for
consumption by various tooling, such as Node.js, transpilers, bundlers,
linters, etc.</p>
<p>The process of managing <code>node_modules/</code> and making sure all the appropriate
dependencies are in place is called &quot;apply&quot; in orogene. Application happens
through a number of commands, automatically. For example, <code>oro reapply</code>, <code>oro add</code>, <code>oro remove</code>, and <code>oro run</code> all make sure to apply your dependencies as
needed, to make sure your <code>node_modules/</code> corresponds to your manifest and
lockfile as much as possible. You can <a href="#--no-apply">disable this behavior</a>, as
desired.</p>
<h2 id="application-blow-by-blow"><a class="header" href="#application-blow-by-blow">Application blow-by-blow</a></h2>
<p>By default, the <code>apply</code> operation will do the following things:</p>
<ol>
<li>Read dependencies declared in <code>package.json</code>.</li>
<li>Generate a dependency tree based on those.
<ol>
<li>If a lockfile (<code>package-lock.kdl</code> or <code>package-lock.json</code>) already
exists, it will be used to <strong>supplement</strong> the resolution.</li>
<li>If any dependencies in the lockfile are missing or don't correspond to
expected dependencies, the tree will ignore that particular lockfile
data and resolve the item(s) itself.</li>
</ol>
</li>
<li>Scan through the existing <code>node_modules/</code>, if any, and prune anything
&quot;extraneous&quot; (aka, removed/outdated dependencies, stray files, etc).</li>
<li>Extract any missing packages into <code>node_modules</code>, into one of two modes:
<ol>
<li>isolated (default, preferred)</li>
<li>hoisted (possibly more compatible, discouraged because it exposes
<a href="#phantom-dependencies">phantom dependencies</a>)</li>
</ol>
</li>
<li>Execute any <code>preinstall</code> scripts on the entire tree, including the root
package.</li>
<li>Link/shim any bins in the dependencies to their appropriate
<code>node_modules/.bin</code> directories.</li>
<li>Execute <code>install</code> and <code>postinstall</code> scripts on the entire tree, including
the root package.</li>
<li>Finally, the updated lockfile is written to <code>package-lock.kdl</code>.</li>
</ol>
<h3 id="modifying-application"><a class="header" href="#modifying-application">Modifying Application</a></h3>
<p>All commands that execute implicit apply accept the same options for modifying
its behavior. To see the full list, refer to the <a href="../commands/apply.html#apply-options">apply command
options</a>, which are also listed in the
<code>-h</code>/<code>--help</code> for any command that performs implicit apply.</p>
<p>Some options of note:</p>
<h4 id="--no-apply"><a class="header" href="#--no-apply"><code>--no-apply</code></a></h4>
<p>Skips the entire apply operation. This option will have no effect on the <code>oro apply</code> command, which forces an apply regardless of your settings.</p>
<p>This option can be useful if you don't like implicit applies and would like to
generally configure Orogene to skip them by default, but let you use <code>--apply</code>
when you happen to want to apply something. To do this, add <code>apply false</code> to
your <a href="./configuration.html#options-from-orokdl"><code>oro.kdl</code> options node</a>.</p>
<h4 id="--locked"><a class="header" href="#--locked"><code>--locked</code></a></h4>
<p>Instead of using lockfiles as a suggestion/optimization, this option will
force an error if the dependencies declared in <code>package.json</code> don't correspond
to the ones declared in an existing <code>package-lock.kdl</code>.</p>
<p>This option has no effect in <code>oro add</code>/<code>oro remove</code>, for hopefully obvious reasons.</p>
<h4 id="--lockfile-only"><a class="header" href="#--lockfile-only"><code>--lockfile-only</code></a></h4>
<p>Resolves the dependency tree and writes the lockfile as appropriate, but skips
anything having to do with <code>node_modules</code> itself, including pruning and
scripts.</p>
<h4 id="--no-lockfile"><a class="header" href="#--no-lockfile"><code>--no-lockfile</code></a></h4>
<p>Skips writing, or updating the lockfile entirely. As of right now, this will
still <strong>read</strong> the lockfile to inform resolution.</p>
<h2 id="adding-or-removing-dependencies"><a class="header" href="#adding-or-removing-dependencies">Adding or Removing Dependencies</a></h2>
<p>You can modify your current project's dependencies three different ways:</p>
<ol>
<li>Use the <a href="../commands/add.html"><code>oro add</code></a> command.</li>
<li>Use the <a href="../commands/remove.html"><code>oro remove</code></a> command.</li>
<li>Edit <code>package.json</code> manually and rerun <a href="../commands/apply.html"><code>oro apply</code></a>.</li>
</ol>
<p>When any of these methods are used, orogene will update the current dependency
tree such that the changed dependencies are reflected. This process means that
the dependencies specified in <code>package-lock.kdl</code> won't necessarily be obeyed:
In general, Orogene will do its best to preserve a dependency's previous
position in the tree, but if a conflict happens, it may be moved or replaced.</p>
<p>In order to guarantee that Orogene only accepts tree modifications on <code>oro add</code>/<code>oro remove</code>, you can use the <a href="#locked"><code>--locked</code></a> option.</p>
<h2 id="specifier-syntax"><a class="header" href="#specifier-syntax">Specifier syntax</a></h2>
<p>A package specifier in orogene is a string describing which package should be
resolved. This string, in some cases (such as in the CLI) can include a name
under which to install that dependency. Specifiers are used both through the
<code>add</code> CLI commands, or in the value field in your dependency objects, next to
the requested package names.</p>
<h3 id="alias"><a class="header" href="#alias">Alias</a></h3>
<p>Syntax: <code>&lt;alias&gt;@&lt;specifier&gt;</code></p>
<p>Alias specifiers work a lot like NPM specifiers, but are able to force a
dependency to use a certain name in the <code>node_modules</code> tree.</p>
<p>When specifying an alias for an NPM registry package, you must use the <code>npm:</code>
prefix before the NPM specifier itself. All other specifiers can be provided
as-is.</p>
<p><em>Examples: <code>underscore@npm:lodash</code>, <code>underscore@github:lodash/lodash</code></em></p>
<h3 id="npm"><a class="header" href="#npm">NPM</a></h3>
<p>Syntax: <code>&lt;package-name&gt;[@(&lt;semver&gt; | &lt;tag&gt;)]</code></p>
<p>NPM specifiers refer to &quot;regular&quot; NPM packages from a registry. The
<code>&lt;package-name&gt;</code> can be any valid scoped or unscoped package name. If followed
by an <code>@</code>, either a semver range or a dist-tag can be specified.</p>
<p>When used in <code>package.json</code>, the <code>&lt;package-name&gt;</code> must be omitted, and it is
recommended that only semver ranges be used.</p>
<p><em>Examples: <code>lodash</code>, <code>lodash@3</code>, <code>@axodotdev/oranda@1.2.3</code></em></p>
<h3 id="path"><a class="header" href="#path">Path</a></h3>
<p>Syntax: <code>&lt;./relative/path&gt; | &lt;C:\absolute\path&gt;</code></p>
<p>Path specifiers refer to the directory in the local machine where a package
exists. They can either be relative (in which case they must be prefixed by
<code>./</code> or <code>.\</code>), or absolute (in which case they must start with either <code>/</code> or a
drive letter).</p>
<p><em>Examples</em>: <code>./path/to/my/proj</code>, <code>C:\src\foo</code></p>
<h3 id="hosted-git"><a class="header" href="#hosted-git">Hosted Git</a></h3>
<p>Syntax: <code>&lt;host&gt;:&lt;org&gt;/&lt;proj&gt;[#(&lt;rev&gt; | semver:&lt;semver&gt;)]</code></p>
<p>Hosted git specifiers refer to packages on a handful of well-known hosted git
platforms, and can be used as a shorthand. You may optionally provide either a
git rev or a <code>semver:</code>-prefixed semver range following a <code>#</code> to resolve to a
particular version, instead of the latest <code>HEAD</code>.</p>
<p>Supported platforms: <code>github</code>, <code>gitlab</code>, <code>gist</code>, <code>bitbucket</code>.</p>
<p><em>Examples: <code>github:orogene/orogene</code>, <code>gist:foo/bar#deadcafe</code>, <code>gitlab:baz/quux#semver:^1.2</code></em></p>
<h3 id="git"><a class="header" href="#git">Git</a></h3>
<p>Syntax: <code>[git+]&lt;git-url&gt;[#(&lt;rev&gt; | semver:&lt;semver&gt;)]</code></p>
<p>Arbitrary git URLs can also be provided to Orogene. For <code>git://</code> URLs, no
prefix is necessary, but other URL types must include a <code>git+</code> prefix. You may
optionally provide either a git rev or a <code>semver:</code>-prefixed semver range
following a <code>#</code> to resolve to a particular version, instead of the latest
<code>HEAD</code>.</p>
<p><em>Examples: <code>git://github.com/lodash/lodash</code>, <code>git+ssh://codeberg.org/foo/bar.git#semver:^1.2.3</code></em></p>
<h2 id="phantom-dependencies"><a class="header" href="#phantom-dependencies">Phantom Dependencies</a></h2>
<p>&quot;Phantom dependencies&quot; refers to a phenomenon where dependencies that weren't
directly declared in a package's <code>package.json</code> can be imported from those
packages. It arises primarily from &quot;hoisted&quot; <code>node_modules</code> trees where, in
order to reduce duplication, shared dependencies are moved as high up the tree
as possible, exposing them to everyone <em>else</em> at that level or deeper.</p>
<p>By default, Orogene uses an &quot;isolated&quot; linking strategy to avoid this: All
dependencies are first written to
<code>&lt;root&gt;/node_modules/.oro-store/&lt;dep&gt;-12345/node_modules/&lt;dep&gt;</code>, then every
dependency inside the store, along with the root package,  gets their own
individual <code>node_modules</code> that contains symlinks <em>back into the store</em>, only
for dependencies directly declared in their <code>package.json</code>. This avoids the
phantom dependencies problems and ensures that you don't accidentally forget
to add a dependency to your <code>package.json</code> just because of the state of your
dependency tree at any given point in time.</p>
<p>The catch with this isolated mode is that most NPM packages in the public
registry have been written in a world where the NPM CLI defaults to &quot;hoisted&quot;
installations, so a number of packages out in the wild depend on this
behavior, purely by accident. The best fix for this is simply to patch the
offending package and install an updated version.</p>
<p>When this is not possible, you can use <code>--hoisted</code> to force Orogene to apply
dependencies in a classic, flattened-as-much-as-possible style. As with other
options, this can be added to your <code>oro.kdl</code> as needed.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guide/configuration.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../guide/telemetry.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../guide/configuration.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../guide/telemetry.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
